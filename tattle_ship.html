<!DOCTYPE html>
<html>
  <head>
    <title>Tattleship! Multiplayer</title>
    <style>
      .grid {
        display: grid;
        grid-template-columns: repeat(10, 40px);
        gap: 2px;
        margin: 20px;
      }
      .square {
        width: 40px;
        height: 40px;
        background: lightblue;
        border: 1px solid blue;
        text-align: center;
        line-height: 40px;
      }
      .hit {
        background: red;
        color: white;
        font-weight: bold;
      }
      .miss {
        background: grey;
      }
      .controls {
        margin: 10px;
      }
      .player-section {
        display: inline-block;
        vertical-align: top;
        margin: 0 20px;
      }
      .missed-letters {
        margin-top: 5px;
        font-size: 14px;
      }
      .setup {
        margin: 10px;
      }
      .message {
        margin: 10px;
        font-size: 14px;
        color: #333;
      }
    </style>
  </head>
  <body>
    <h1>Tattleship! Multiplayer</h1>
    <div class="player-section">
      <h2>Player 1's Board</h2>
      <div id="player1Board"></div>
      <div class="controls">
        <input
          type="text"
          id="player1Guess"
          maxlength="1"
          placeholder="Letter"
          disabled
        />
        <button id="player1GuessButton" onclick="guessLetter(0)" disabled>
          Guess
        </button>
        <div class="missed-letters">
          Missed: <span id="player1Misses"></span>
        </div>
      </div>
      <div class="setup" id="player1Setup">
        <p id="player1LettersDisplay">
          Player 1 Letters: <span id="player1Letters"></span>
        </p>
        <input type="password" id="player1Word2" placeholder="2-letter word" />
        <input type="password" id="player1Word3" placeholder="3-letter word" />
        <input type="password" id="player1Word4" placeholder="4-letter word" />
        <button id="player1SubmitButton" onclick="submitWords(0)">
          Submit Words
        </button>
      </div>
      <p class="message" id="player1Message">
        Enter your words using your letters!
      </p>
    </div>
    <div class="player-section">
      <h2>Player 2's Board</h2>
      <div id="player2Board"></div>
      <div class="controls">
        <input
          type="text"
          id="player2Guess"
          maxlength="1"
          placeholder="Letter"
          disabled
        />
        <button id="player2GuessButton" onclick="guessLetter(1)" disabled>
          Guess
        </button>
        <div class="missed-letters">
          Missed: <span id="player2Misses"></span>
        </div>
      </div>
      <div class="setup" id="player2Setup">
        <p id="player2LettersDisplay">
          Player 2 Letters: <span id="player2Letters"></span>
        </p>
        <input type="password" id="player2Word2" placeholder="2-letter word" />
        <input type="password" id="player2Word3" placeholder="3-letter word" />
        <input type="password" id="player2Word4" placeholder="4-letter word" />
        <button id="player2SubmitButton" onclick="submitWords(1)">
          Submit Words
        </button>
      </div>
      <p class="message" id="player2Message">
        Enter your words using your letters!
      </p>
    </div>
    <button onclick="newGame()">New Game</button>

    <script>
      const vowels = ["A", "E", "I", "O", "U"];
      const consonants = [
        "B",
        "C",
        "D",
        "F",
        "G",
        "H",
        "J",
        "K",
        "L",
        "M",
        "N",
        "P",
        "Q",
        "R",
        "S",
        "T",
        "V",
        "W",
        "X",
        "Y",
        "Z",
      ];

      let players = [
        {
          board: [],
          ships: [],
          letters: [],
          revealed: [],
          tries: 0,
          shipsLeft: 3,
          misses: [],
          availableLetters: [],
          wordsSubmitted: false,
        },
        {
          board: [],
          ships: [],
          letters: [],
          revealed: [],
          tries: 0,
          shipsLeft: 3,
          misses: [],
          availableLetters: [],
          wordsSubmitted: false,
        },
      ];
      let currentPlayer = 0;
      let gameOver = false;

      function newGame() {
        players.forEach((player, index) => {
          player.tries = 0;
          player.ships = [];
          player.letters = Array(10)
            .fill()
            .map(() => Array(10).fill(""));
          player.revealed = Array(10)
            .fill()
            .map(() => Array(10).fill(false));
          player.board = Array(10)
            .fill()
            .map(() => Array(10).fill(false));
          player.shipsLeft = 3;
          player.misses = [];
          player.availableLetters = generateRandomLetters();
          player.wordsSubmitted = false;
          document.getElementById(`player${index + 1}Guess`).value = "";
          document.getElementById(`player${index + 1}Misses`).textContent = "";
          document.getElementById(`player${index + 1}Letters`).textContent =
            player.availableLetters.join(", ");
          document.getElementById(`player${index + 1}Word2`).value = "";
          document.getElementById(`player${index + 1}Word3`).value = "";
          document.getElementById(`player${index + 1}Word4`).value = "";
          document.getElementById(`player${index + 1}Guess`).disabled = true;
          document.getElementById(
            `player${index + 1}GuessButton`
          ).disabled = true;
          document.getElementById(
            `player${index + 1}SubmitButton`
          ).disabled = false;
          document.getElementById(`player${index + 1}Setup`).style.display =
            "block";
          document.getElementById(`player${index + 1}Message`).textContent =
            "Enter your words using your letters!";
        });
        currentPlayer = 0;
        gameOver = false;
        makeBoards();
        updateInputs();
      }

      function generateRandomLetters() {
        let letters = [];
        let usedIndices = new Set();

        while (letters.length < 3) {
          let index = Math.floor(Math.random() * vowels.length);
          if (!usedIndices.has("v" + index)) {
            letters.push(vowels[index]);
            usedIndices.add("v" + index);
          }
        }

        while (letters.length < 10) {
          let index = Math.floor(Math.random() * consonants.length);
          if (!usedIndices.has("c" + index)) {
            letters.push(consonants[index]);
            usedIndices.add("c" + index);
          }
        }

        return letters.sort(() => Math.random() - 0.5);
      }

      function submitWords(playerIndex) {
        let word2 = document
          .getElementById(`player${playerIndex + 1}Word2`)
          .value.toUpperCase();
        let word3 = document
          .getElementById(`player${playerIndex + 1}Word3`)
          .value.toUpperCase();
        let word4 = document
          .getElementById(`player${playerIndex + 1}Word4`)
          .value.toUpperCase();
        let available = players[playerIndex].availableLetters;

        if (word2.length !== 2 || word3.length !== 3 || word4.length !== 4) {
          document.getElementById(
            `player${playerIndex + 1}Message`
          ).textContent = "Words must be 2, 3, and 4 letters long!";
          return;
        }

        let allLetters = (word2 + word3 + word4).split("");
        for (let letter of allLetters) {
          if (!available.includes(letter)) {
            document.getElementById(
              `player${playerIndex + 1}Message`
            ).textContent = `Use only your available letters! (${players[
              playerIndex
            ].availableLetters.join(", ")})`;
            return;
          }
        }

        placeShip(players[playerIndex], 2, word2);
        placeShip(players[playerIndex], 3, word3);
        placeShip(players[playerIndex], 4, word4);
        players[playerIndex].wordsSubmitted = true;

        document.getElementById(
          `player${playerIndex + 1}SubmitButton`
        ).disabled = true;
        document.getElementById(`player${playerIndex + 1}Word2`).style.display =
          "none";
        document.getElementById(`player${playerIndex + 1}Word3`).style.display =
          "none";
        document.getElementById(`player${playerIndex + 1}Word4`).style.display =
          "none";
        document.getElementById(
          `player${playerIndex + 1}SubmitButton`
        ).style.display = "none";

        if (players[0].wordsSubmitted && players[1].wordsSubmitted) {
          document.getElementById("player1Message").textContent =
            "Your turn: Guess a letter!";
          document.getElementById("player2Message").textContent =
            "Wait for your turn!";
          document.getElementById("player1Guess").disabled = false;
          document.getElementById("player1GuessButton").disabled = false;
          document.getElementById("player2Guess").disabled = false;
          document.getElementById("player2GuessButton").disabled = true;
          // Hide both players' setup (including letters)
          document.getElementById("player1Setup").style.display = "none";
          document.getElementById("player2Setup").style.display = "none";
          makeBoards();
          updateInputs();
        } else {
          document.getElementById(
            `player${playerIndex + 1}Message`
          ).textContent = "Words submitted! Wait for the other player.";
          document.getElementById(
            `player${playerIndex === 0 ? 2 : 1}Message`
          ).textContent = "Enter your words using your letters!";
          document.getElementById(
            `player${playerIndex === 0 ? 2 : 1}GuessButton`
          ).disabled = false;
        }
      }

      function placeShip(player, size, word) {
        let placed = false;
        while (!placed) {
          let isHorizontal = Math.random() < 0.5 ? true : false;
          let row,
            col,
            canPlace = true;

          if (isHorizontal) {
            row = Math.floor(Math.random() * 10);
            col = Math.floor(Math.random() * (10 - size + 1));
            for (let i = 0; i < size; i++) {
              if (player.board[row][col + i]) {
                canPlace = false;
                break;
              }
            }
            if (canPlace) {
              let shipSquares = [];
              for (let i = 0; i < size; i++) {
                player.board[row][col + i] = true;
                player.letters[row][col + i] = word[i];
                shipSquares.push({ row: row, col: col + i });
              }
              player.ships.push({ squares: shipSquares, hits: 0, size: size });
              placed = true;
            }
          } else {
            row = Math.floor(Math.random() * (10 - size + 1));
            col = Math.floor(Math.random() * 10);
            for (let i = 0; i < size; i++) {
              if (player.board[row + i][col]) {
                canPlace = false;
                break;
              }
            }
            if (canPlace) {
              let shipSquares = [];
              for (let i = 0; i < size; i++) {
                player.board[row + i][col] = true;
                player.letters[row + i][col] = word[i];
                shipSquares.push({ row: row + i, col: col });
              }
              player.ships.push({ squares: shipSquares, hits: 0, size: size });
              placed = true;
            }
          }
        }
      }

      function makeBoards() {
        let player1Board = document.getElementById("player1Board");
        player1Board.innerHTML = "";
        player1Board.className = "grid";
        for (let row = 0; row < 10; row++) {
          for (let col = 0; col < 10; col++) {
            let square = document.createElement("div");
            square.className = "square";
            if (players[0].revealed[row][col]) {
              square.className = players[0].board[row][col]
                ? "square hit"
                : "square miss";
              square.textContent = players[0].board[row][col]
                ? players[0].letters[row][col]
                : "";
            }
            player1Board.appendChild(square);
          }
        }

        let player2Board = document.getElementById("player2Board");
        player2Board.innerHTML = "";
        player2Board.className = "grid";
        for (let row = 0; row < 10; row++) {
          for (let col = 0; col < 10; col++) {
            let square = document.createElement("div");
            square.className = "square";
            if (players[1].revealed[row][col]) {
              square.className = players[1].board[row][col]
                ? "square hit"
                : "square miss";
              square.textContent = players[1].board[row][col]
                ? players[1].letters[row][col]
                : "";
            }
            player2Board.appendChild(square);
          }
        }
        document.getElementById("player1Misses").textContent =
          players[0].misses.join(", ");
        document.getElementById("player2Misses").textContent =
          players[1].misses.join(", ");
      }

      function updateInputs() {
        document.getElementById("player1GuessButton").disabled =
          gameOver ||
          !players[0].wordsSubmitted ||
          !players[1].wordsSubmitted ||
          currentPlayer !== 0;
        document.getElementById("player2GuessButton").disabled =
          gameOver ||
          !players[0].wordsSubmitted ||
          !players[1].wordsSubmitted ||
          currentPlayer !== 1;
        document.getElementById("player1Guess").disabled =
          gameOver || !players[0].wordsSubmitted || !players[1].wordsSubmitted;
        document.getElementById("player2Guess").disabled =
          gameOver || !players[0].wordsSubmitted || !players[1].wordsSubmitted;
        if (
          !gameOver &&
          currentPlayer === 0 &&
          players[0].wordsSubmitted &&
          players[1].wordsSubmitted
        )
          document.getElementById("player1Guess").focus();
        else if (
          !gameOver &&
          players[0].wordsSubmitted &&
          players[1].wordsSubmitted
        )
          document.getElementById("player2Guess").focus();
      }

      function guessLetter(playerIndex) {
        if (gameOver) {
          document.getElementById(
            `player${playerIndex + 1}Message`
          ).textContent = "Game over! Start a new game to play again.";
          return;
        }

        if (playerIndex !== currentPlayer) {
          document.getElementById(
            `player${playerIndex + 1}Message`
          ).textContent = `Not your turn! Player ${currentPlayer + 1}'s turn!`;
          return;
        }

        let guessInput = document.getElementById(
          `player${playerIndex + 1}Guess`
        );
        let guess = guessInput.value.toUpperCase();
        if (!guess || guess.length !== 1) {
          document.getElementById(
            `player${playerIndex + 1}Message`
          ).textContent = `Please type one letter! ${
            players[1 - currentPlayer].shipsLeft
          } enemy ships left. Tries: ${players[currentPlayer].tries}`;
          return;
        }

        players[currentPlayer].tries += 1;
        let opponent = 1 - currentPlayer;

        for (let row = 0; row < 10; row++) {
          for (let col = 0; col < 10; col++) {
            if (
              players[opponent].board[row][col] &&
              players[opponent].letters[row][col] === guess &&
              !players[opponent].revealed[row][col]
            ) {
              players[opponent].revealed[row][col] = true;
              for (let ship of players[opponent].ships) {
                for (let sq of ship.squares) {
                  if (sq.row === row && sq.col === col) {
                    ship.hits += 1;
                    if (ship.hits === ship.size) {
                      players[opponent].shipsLeft -= 1;
                    }
                    break;
                  }
                }
              }
              makeBoards();
              if (players[opponent].shipsLeft === 0) {
                document.getElementById(
                  `player${currentPlayer + 1}Message`
                ).textContent = `YOU WIN! Sank all enemy ships in ${players[currentPlayer].tries} tries!`;
                document.getElementById(
                  `player${opponent + 1}Message`
                ).textContent = `Player ${
                  currentPlayer + 1
                } wins! All your ships are sunk.`;
                gameOver = true;
                updateInputs();
              } else {
                document.getElementById(
                  `player${currentPlayer + 1}Message`
                ).textContent = `Hit! ${players[opponent].shipsLeft} enemy ships left. Tries: ${players[currentPlayer].tries}`;
                document.getElementById(
                  `player${opponent + 1}Message`
                ).textContent = `Your turn: Guess a letter! ${players[currentPlayer].shipsLeft} enemy ships left. Tries: ${players[opponent].tries}`;
                currentPlayer = opponent;
                updateInputs();
              }
              guessInput.value = "";
              return;
            }
          }
        }

        if (!players[currentPlayer].misses.includes(guess)) {
          players[currentPlayer].misses.push(guess);
        }
        document.getElementById(
          `player${currentPlayer + 1}Message`
        ).textContent = `Miss! ${players[opponent].shipsLeft} enemy ships left. Tries: ${players[currentPlayer].tries}`;
        document.getElementById(
          `player${opponent + 1}Message`
        ).textContent = `Your turn: Guess a letter! ${players[currentPlayer].shipsLeft} enemy ships left. Tries: ${players[opponent].tries}`;
        currentPlayer = opponent;
        makeBoards();
        guessInput.value = "";
        updateInputs();
      }

      newGame();
    </script>
  </body>
</html>
